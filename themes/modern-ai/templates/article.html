{% extends "base.html" %}

{% block title %}
{% set title_text = article.title %}
{% set site_text = SITENAME %}
{% if (title_text|length + site_text|length + 3) > 70 %}
{{ title_text|truncate(70, True, '...') }}
{% else %}
{{ title_text }} | {{ site_text }}
{% endif %}
{% endblock %}
{% block description %}{{ article.summary|striptags|truncate(160) }}{% endblock %}
{% block og_title %}{{ article.title }}{% endblock %}
{% block og_description %}{{ article.summary|striptags|truncate(160) }}{% endblock %}
{% block og_image %}{% if article.image %}{% if article.image.startswith('http') %}{{ article.image }}{% else %}{{
SITEURL }}/{{ article.image }}{% endif %}{% else %}{{ SITEURL }}/{{ OG_IMAGE }}{% endif %}{% endblock %}

{% block content %}
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "NewsArticle",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "{{ SITEURL }}/{{ article.url }}"
  },
  "headline": "{{ article.title }}",
  "description": "{{ article.summary|striptags|truncate(160) }}",
  "image": [
    "{% if article.image %}{% if article.image.startswith('http') %}{{ article.image }}{% else %}{{ SITEURL }}/{{ article.image }}{% endif %}{% else %}{{ SITEURL }}/{{ OG_IMAGE }}{% endif %}"
  ],
  "datePublished": "{{ article.date.isoformat() }}",
  "dateModified": "{{ article.modified.isoformat() if article.modified else article.date.isoformat() }}",
  "author": {
    "@type": "Person",
    "name": "{{ article.author }}",
    "url": "{{ SITEURL }}/{{ article.author.url }}"
  },
  "publisher": {
    "@type": "Organization",
    "name": "{{ SITENAME }}",
    "logo": {
      "@type": "ImageObject",
      "url": "{{ SITEURL }}/favicon.ico"
    }
  }
}
</script>
<article class="single-post">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="{{ article.date.isoformat() }}">{{ article.locale_date }}</time>
    </div>
    <h1>{{ article.title }}</h1>
  </header>

  {% if article.image %}
  <div class="featured-image">
    {% if article.image.startswith('http') %}
    <img src="{{ article.image }}" alt="{{ article.title }}" loading="lazy" />
    {% else %}
    <img src="{{ SITEURL }}/{{ article.image }}" alt="{{ article.title }}" loading="lazy" />
    {% endif %}
  </div>
  {% endif %}

  <div class="post-content">
    {{ article.content }}
  </div>

  <div class="article-footer-meta">
    <p><strong>Category:</strong> <a href="{{ SITEURL }}/{{ article.category.url }}">{{ article.category }}</a></p>
    {% if article.tags %}
    <div class="tags-list">
      <strong>Tags:</strong>
      {% for tag in article.tags %}
      <span class="tag">#{{ tag }}</span>
      {% endfor %}
    </div>
    {% endif %}
  </div>

  {% if article.related_posts %}
  <div class="related-posts">
    <h3>Related Articles</h3>
    <ul>
      {% for related_post in article.related_posts %}
      <li><a href="{{ SITEURL }}/{{ related_post.url }}">{{ related_post.title }}</a></li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <div class="post-footer">
    <a href="{{ SITEURL }}/" class="back-link">&larr; Back to Home</a>
  </div>
</article>
{% endblock %}